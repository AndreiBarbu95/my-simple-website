version: v1.1.0
steps:
- build: -t {{.Run.Registry}}/simple:{{.Run.ID}} -f Dockerfile .

- cmd: 
  image: {{.Run.Registry}}/simple:{{.Run.ID}}
  detach: true
  ports: ["8080:80"]
  id: test

- cmd: |
    container_id=$(docker ps -aqf "name=test")
    docker stop "${container_id}"
    echo "Container ID: $container_id"
- push:
  - "{{.Run.Registry}}/simple:{{.Run.ID}}"
