version: v1.1.0
steps:
- build:
    dockerfile: Dockerfile 
    image: "{{.Run.Registry}}/simple:{{.Run.ID}}"
  displayName: 'Build target image'

- cmd:
    image: "{{.Run.Registry}}/simple:{{.Run.ID}}"
    detach: true
    ports: ["8080:80"]
  id: test
  displayName: 'Run target image'

- cmd: |
    container_id=$(docker ps -aqf "name=test")
    docker stop "${container_id}"
    echo "Container ID: $container_id"
  displayName: 'Stop and Print Container ID'

- push:
  images: "{{.Run.Registry}}/simple:{{.Run.ID}}"
  displayName: 'Push target image'
